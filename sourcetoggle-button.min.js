(function(e,r,n){var t=r.Deferred(),o=r.Deferred(),i=['<div class="source-toggle rButton" title="Change Media">','<span class="ui-icon ui-icon-video"></span>',"</div>"].join("");e.bindHelper("Kaltura_CheckConfig",function(e,r,n){if(!r.isPluginEnabled("sourceToggle")){return n()}r.bindHelper("widgetLoaded",function(){o.resolve(r)});r.bindHelper("onplay",function(){t.resolve()});n()});o.done(function(e){var r=e.getInterface(),n=new a(e),o=r.find(".play_head");r.find(".control-bar .kaltura-icon").closest(".rButton").after(i);o.css("right",parseInt(o.css("right"),10)+r.find(".source-toggle").on("click",function(){if(t.isResolved()){t=n.toggle(e.evaluate("{video.player.currentTime}"))}}).outerWidth(true))});function a(e){var r=this,n,t;r.player=e;r.current=0;n=e.evaluate("{mediaProxy.entry}");r.sources=[n.id];try{t=JSON.parse(n.partnerData);r.sources=r.sources.concat(t.sources||[])}catch(o){}}a.prototype={postFix:".sourceToggle",toggle:function(e){var n=this,t=(n.current+1)%n.sources.length;if(n.current==t){return}n.player.sendNotification("changeMedia",{entryId:n.sources[t]});n.player.addJsListener("playerSeekEnd",function(){n.player.sendNotification("doPlay");n.player.removeJsListener("playerSeekEnd")});n.player.sendNotification("doSeek",e);n.current=t;return r.Deferred()}}})(window.mw,window.jQuery,window);